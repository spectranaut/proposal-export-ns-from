<!DOCTYPE html>
<meta charset="utf-8">
<pre class="metadata">
title: ECMAScript export ns from
stage: 1
location: https://tc39.github.io/proposal-export-ns-from/
copyright: false
contributors: Lee Byron
</pre>
<script src="https://bterlson.github.io/ecmarkup/ecmarkup.js" defer></script>
<link rel="stylesheet" href="https://bterlson.github.io/ecmarkup/elements.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/solarized_light.min.css">
<style>
  tr.ins {
    background-color: #e0f8e0;
  }
  del {
    text-decoration: none;
  }
</style>

<emu-intro id="intro">
  <h1>Introduction</h1>

  <p>This proposal adds a new form of "export from" which exports another module's namespace
    exotic object as an exported name of another, filling a use case similar to the use cases
    for existing "export from" forms.</p>

  <p>See <a href="https://github.com/leebyron/ecmascript-export-ns-from">the proposal repository</a> for motivations and more information.</p>

  <emu-note>
    <p>This proposal is closely related to the <a href="https://github.com/leebyron/ecmascript-export-default-from">export default from</a> proposal.</p>
  </emu-note>

  <emu-note>
    <p>This spec proposal is written as a diff against the <a href="http://www.ecma-international.org/ecma-262/6.0/">existing ECMAScript specification</a>.</p>
  </emu-note>
</emu-intro>

<!-- es6num="15" -->
<emu-clause id="sec-ecmascript-language-scripts-and-modules">
  <h1>ECMAScript Language: Scripts and Modules</h1>

  <emu-note>This is <a href="http://www.ecma-international.org/ecma-262/6.0/#sec-ecmascript-language-scripts-and-modules">Chapter 15</a> in the current spec.</emu-note>

  <!-- es6num="15.2" -->
  <emu-clause id="sec-modules">
    <h1>Modules</h1>

    <!-- es6num="15.2.1" -->
    <emu-clause id="sec-module-semantics">
      <h1>Module Semantics</h1>

      <!-- es6num="15.2.1.15" -->
      <emu-clause id="sec-abstract-module-records">
        <h1>Abstract Module Records</h1>
        <p>A <dfn>Module Record</dfn> encapsulates structural information about the imports and exports of a single module. This information is used to link the imports and exports of sets of connected modules. A Module Record includes four fields that are only used when evaluating a module.</p>
        <p>For specification purposes Module Record values are values of the Record specification type and can be thought of as existing in a simple object-oriented hierarchy where Module Record is an abstract class with concrete subclasses. This specification only defines a single Module Record concrete subclass named Source Text Module Record. Other specifications and implementations may define additional Module Record subclasses corresponding to alternative module definition facilities that they defined.</p>
        <p>Module Record defines the fields listed in <emu-xref href="#table-36"></emu-xref>. All Module Definition subclasses include at least those fields. Module Record also defines the abstract method list in <emu-xref href="#table-37"></emu-xref>. All Module definition subclasses must provide concrete implementations of these abstract methods.</p>
        <emu-table id="table-36" caption="Module Record Fields">
          <table>
            <thead>
            <tr>
              <th>
                Field Name
              </th>
              <th>
                Value Type
              </th>
              <th>
                Meaning
              </th>
            </tr>
            </thead>
            <tbody>
            <tr>
              <td>
                [[Realm]]
              </td>
              <td>
                Realm Record | *undefined*
              </td>
              <td>
                The Realm within which this module was created. *undefined* if not yet assigned.
              </td>
            </tr>
            <tr>
              <td>
                [[Environment]]
              </td>
              <td>
                Lexical Environment | *undefined*
              </td>
              <td>
                The Lexical Environment containing the top level bindings for this module. This field is set when the module is instantiated.
              </td>
            </tr>
            <tr>
              <td>
                [[Namespace]]
              </td>
              <td>
                Object | *undefined*
              </td>
              <td>
                The Module Namespace Object (<emu-xref href="#sec-module-namespace-objects"></emu-xref>) if one has been created for this module. Otherwise *undefined*.
              </td>
            </tr>
            <tr>
              <td>
                [[HostDefined]]
              </td>
              <td>
                Any, default value is *undefined*.
              </td>
              <td>
                Field reserved for use by host environments that need to associate additional information with a module.
              </td>
            </tr>
            </tbody>
          </table>
        </emu-table>
        <emu-table id="table-37" caption="Abstract Methods of Module Records">
          <table>
            <tbody>
            <tr>
              <th>
                Method
              </th>
              <th>
                Purpose
              </th>
            </tr>
            <tr>
              <td>
                GetExportedNames(_exportStarSet_)
              </td>
              <td>
                Return a list of all names that are either directly or indirectly exported from this module.
              </td>
            </tr>
            <tr>
              <td>
                ResolveExport(_exportName_, _resolveSet_)
              </td>
              <td>
                <p>Return the binding of a name exported by this module. Bindings are represented by a <dfn id="resolvedbinding-record">ResolvedBinding Record</dfn>, of the form {[[Module]]: Module Record, [[BindingName]]: String<ins>, [[isNamespace]]: Boolean</ins>}. Return *null* if the name cannot be resolved, or `"ambiguous"` if multiple bindings were found.</p>
                <p>This operation must be idempotent if it completes normally. Each time it is called with a specific _exportName_, _resolveSet_ pair as arguments it must return the same result.</p>
              </td>
            </tr>
            <tr>
              <td>
                Instantiate()
              </td>
              <td>
                <p>Prepare the module for evaluation by transitively resolving all module dependencies and creating a module Environment Record.</p>
              </td>
            </tr>
            <tr>
              <td>
                Evaluate()
              </td>
              <td>
                <p>If this module has already been evaluated successfully, return *undefined*; if it has already been evaluated unsuccessfully, throw the exception that was produced. Otherwise, transitively evaluate all module dependencies of this module and then evaluate this module.</p>
                <p>Instantiate must have completed successfully prior to invoking this method.</p>
              </td>
            </tr>
            </tbody>
          </table>
        </emu-table>
      </emu-clause>

      <!-- es6num="15.2.1.16" -->
      <emu-clause id="sec-source-text-module-records">
        <h1>Source Text Module Records</h1>

        <p>A <dfn id="sourctextmodule-record">Source Text Module Record</dfn> is used to represent information about a module that was defined from ECMAScript source text (<emu-xref href="#sec-ecmascript-language-source-code"></emu-xref>) that was parsed using the goal symbol |Module|. Its fields contain digested information about the names that are imported by the module and its concrete methods use this digest to link, instantiate, and evaluate the module.</p>

        <p>A Source Text Module Record can exist in a module graph with other subclasses of the abstract Module Record type. However, non-source text Module Records must not participate in dependency cycles with Source Text Module Records.</p>

        <p>In addition to the fields, defined in <emu-xref href="#table-36"></emu-xref>, Source Text Module Records have the additional fields listed in <emu-xref href="#table-38"></emu-xref>. Each of these fields is initially set in ParseModule.</p>

        <emu-table id="table-38" caption="Additional Fields of Source Text Module Records">
          <table>
            <tbody>
            <tr>
              <th>
                Field Name
              </th>
              <th>
                Value Type
              </th>
              <th>
                Meaning
              </th>
            </tr>
            <tr>
              <td>
                [[ECMAScriptCode]]
              </td>
              <td>
                a Parse Node
              </td>
              <td>
                The result of parsing the source text of this module using |Module| as the goal symbol.
              </td>
            </tr>
            <tr>
              <td>
                [[RequestedModules]]
              </td>
              <td>
                List of String
              </td>
              <td>
                A List of all the |ModuleSpecifier| strings used by the module represented by this record to request the importation of a module. The List is source code occurrence ordered.
              </td>
            </tr>
            <tr>
              <td>
                [[ImportEntries]]
              </td>
              <td>
                List of ImportEntry Records
              </td>
              <td>
                A List of ImportEntry records derived from the code of this module.
              </td>
            </tr>
            <tr>
              <td>
                [[LocalExportEntries]]
              </td>
              <td>
                List of ExportEntry Records
              </td>
              <td>
                A List of ExportEntry records derived from the code of this module that correspond to declarations that occur within the module.
              </td>
            </tr>
            <tr>
              <td>
                [[IndirectExportEntries]]
              </td>
              <td>
                List of ExportEntry Records
              </td>
              <td>
                A List of ExportEntry records derived from the code of this module that correspond to reexported imports that occur within the module.
              </td>
            </tr>
            <tr>
              <td>
                [[StarExportEntries]]
              </td>
              <td>
                List of ExportEntry Records
              </td>
              <td>
                A List of ExportEntry records derived from the code of this module that correspond to export * declarations that occur within the module.
              </td>
            </tr>
            <tr>
              <td>
                [[Status]]
              </td>
              <td>
                String
              </td>
              <td>
                Initially `"uninstantiated"`. Transitions to `"instantiating"`, `"instantiated"`, `"evaluating"`, `"evaluated"` (in that order) as the module progresses throughout its lifecycle.
              </td>
            </tr>
            <tr>
              <td>
                [[EvaluationError]]
              </td>
              <td>
                An abrupt completion | *undefined*
              </td>
              <td>
                A completion of type ~throw~ representing the exception that occurred during evaluation.  *undefined* if no exception occurred or if [[Status]] is not `"evaluated"`.
              </td>
            </tr>
            <tr>
              <td>
                [[DFSIndex]]
              </td>
              <td>
                Integer | *undefined*
              </td>
              <td>
                Auxiliary field used during Instantiate and Evaluate only.
                If [[Status]] is `"instantiating"` or `"evaluating"`, this non-negative number records the point at which the module was first visited during the ongoing depth-first traversal of the dependency graph.
              </td>
            </tr>
            <tr>
              <td>
                [[DFSAncestorIndex]]
              </td>
              <td>
                Integer | *undefined*
              </td>
              <td>
                Auxiliary field used during Instantiate and Evaluate only. If [[Status]] is `"instantiating"` or `"evaluating"`, this is either the module's own [[DFSIndex]] or that of an "earlier" module in the same strongly connected component.
              </td>
            </tr>
            </tbody>
          </table>
        </emu-table>
        <p>An <dfn id="importentry-record">ImportEntry Record</dfn> is a Record that digests information about a single declarative import. Each ImportEntry Record has the fields defined in <emu-xref href="#table-39"></emu-xref>:</p>
        <emu-table id="table-39" caption="ImportEntry Record Fields">
          <table>
            <tbody>
            <tr>
              <th>
                Field Name
              </th>
              <th>
                Value Type
              </th>
              <th>
                Meaning
              </th>
            </tr>
            <tr>
              <td>
                [[ModuleRequest]]
              </td>
              <td>
                String
              </td>
              <td>
                String value of the |ModuleSpecifier| of the |ImportDeclaration|.
              </td>
            </tr>
            <tr>
              <td>
                [[ImportName]]
              </td>
              <td>
                String
              </td>
              <td>
                The name under which the desired binding is exported by the module identified by [[ModuleRequest]]. The value `"*"` indicates that the import request is for the target module's namespace object.
              </td>
            </tr>
            <tr>
              <td>
                [[LocalName]]
              </td>
              <td>
                String
              </td>
              <td>
                The name that is used to locally access the imported value from within the importing module.
              </td>
            </tr>
            </tbody>
          </table>
        </emu-table>
        <emu-note>
          <p><emu-xref href="#table-40"></emu-xref> gives examples of ImportEntry records fields used to represent the syntactic import forms:</p>
          <emu-table id="table-40" caption="Import Forms Mappings to ImportEntry Records" informative>
            <table>
              <tbody>
              <tr>
                <th>
                  Import Statement Form
                </th>
                <th>
                  [[ModuleRequest]]
                </th>
                <th>
                  [[ImportName]]
                </th>
                <th>
                  [[LocalName]]
                </th>
              </tr>
              <tr>
                <td>
                  `import v from "mod";`
                </td>
                <td>
                  `"mod"`
                </td>
                <td>
                  `"default"`
                </td>
                <td>
                  `"v"`
                </td>
              </tr>
              <tr>
                <td>
                  `import * as ns from "mod";`
                </td>
                <td>
                  `"mod"`
                </td>
                <td>
                  `"*"`
                </td>
                <td>
                  `"ns"`
                </td>
              </tr>
              <tr>
                <td>
                  `import {x} from "mod";`
                </td>
                <td>
                  `"mod"`
                </td>
                <td>
                  `"x"`
                </td>
                <td>
                  `"x"`
                </td>
              </tr>
              <tr>
                <td>
                  `import {x as v} from "mod";`
                </td>
                <td>
                  `"mod"`
                </td>
                <td>
                  `"x"`
                </td>
                <td>
                  `"v"`
                </td>
              </tr>
              <tr>
                <td>
                  `import "mod";`
                </td>
                <td colspan="3">
                  An ImportEntry Record is not created.
                </td>
              </tr>
              </tbody>
            </table>
          </emu-table>
        </emu-note>
        <p>An <dfn id="exportentry-record">ExportEntry Record</dfn> is a Record that digests information about a single declarative export. Each ExportEntry Record has the fields defined in <emu-xref href="#table-41"></emu-xref>:</p>
        <emu-table id="table-41" caption="ExportEntry Record Fields">
          <table>
            <tbody>
            <tr>
              <th>
                Field Name
              </th>
              <th>
                Value Type
              </th>
              <th>
                Meaning
              </th>
            </tr>
            <tr>
              <td>
                [[ExportName]]
              </td>
              <td>
                String
              </td>
              <td>
                The name used to export this binding by this module.
              </td>
            </tr>
            <tr>
              <td>
                [[ModuleRequest]]
              </td>
              <td>
                String | null
              </td>
              <td>
                The String value of the |ModuleSpecifier| of the |ExportDeclaration|. *null* if the |ExportDeclaration| does not have a |ModuleSpecifier|.
              </td>
            </tr>
            <tr>
              <td>
                [[ImportName]]
              </td>
              <td>
                String | null
              </td>
              <td>
                The name under which the desired binding is exported by the module identified by [[ModuleRequest]]. *null* if the |ExportDeclaration| does not have a |ModuleSpecifier|. `"*"` indicates that the export request is for all exported bindings.
              </td>
            </tr>
            <tr>
              <td>
                [[LocalName]]
              </td>
              <td>
                String | null
              </td>
              <td>
                The name that is used to locally access the exported value from within the importing module. *null* if the exported value is not locally accessible from within the module.
              </td>
            </tr>
            </tbody>
          </table>
        </emu-table>

        <emu-note>
          <p><emu-xref href="#table-42">Table 42</emu-xref> gives examples of the ExportEntry record fields used to represent the syntactic export forms:</p>
          <emu-table id="table-42" caption="Export Forms Mappings to ExportEntry Records" informative>
            <table>
              <tbody>
              <tr>
                <th>
                  Export Statement Form
                </th>
                <th>
                  [[ExportName]]
                </th>
                <th>
                  [[ModuleRequest]]
                </th>
                <th>
                  [[ImportName]]
                </th>
                <th>
                  [[LocalName]]
                </th>
              </tr>
              <tr>
                <td>
                  `export var v;`
                </td>
                <td>
                  `"v"`
                </td>
                <td>
                  *null*
                </td>
                <td>
                  *null*
                </td>
                <td>
                  `"v"`
                </td>
              </tr>
              <tr>
                <td>
                  `export default function f(){}`
                </td>
                <td>
                  `"default"`
                </td>
                <td>
                  *null*
                </td>
                <td>
                  *null*
                </td>
                <td>
                  `"f"`
                </td>
              </tr>
              <tr>
                <td>
                  `export default function(){}`
                </td>
                <td>
                  `"default"`
                </td>
                <td>
                  *null*
                </td>
                <td>
                  *null*
                </td>
                <td>
                  `"*default*"`
                </td>
              </tr>
              <tr>
                <td>
                  `export default 42;`
                </td>
                <td>
                  `"default"`
                </td>
                <td>
                  *null*
                </td>
                <td>
                  *null*
                </td>
                <td>
                  `"*default*"`
                </td>
              </tr>
              <tr>
                <td>
                  `export {x};`
                </td>
                <td>
                  `"x"`
                </td>
                <td>
                  *null*
                </td>
                <td>
                  *null*
                </td>
                <td>
                  `"x"`
                </td>
              </tr>
              <tr>
                <td>
                  `export {v as x};`
                </td>
                <td>
                  `"x"`
                </td>
                <td>
                  *null*
                </td>
                <td>
                  *null*
                </td>
                <td>
                  `"v"`
                </td>
              </tr>
              <tr>
                <td>
                  `export {x} from "mod";`
                </td>
                <td>
                  `"x"`
                </td>
                <td>
                  `"mod"`
                </td>
                <td>
                  `"x"`
                </td>
                <td>
                  *null*
                </td>
              </tr>
              <tr>
                <td>
                  `export {v as x} from "mod";`
                </td>
                <td>
                  `"x"`
                </td>
                <td>
                  `"mod"`
                </td>
                <td>
                  `"v"`
                </td>
                <td>
                  *null*
                </td>
              </tr>
              <tr>
                <td>
                  `export * from "mod";`
                </td>
                <td>
                  *null*
                </td>
                <td>
                  `"mod"`
                </td>
                <td>
                  `"*"`
                </td>
                <td>
                  *null*
                </td>
              </tr>
              <tr class="ins">
                <td>
                  `export * as ns from "mod";`
                </td>
                <td>
                  `"ns"`
                </td>
                <td>
                  `"mod"`
                </td>
                <td>
                  `"*"`
                </td>

                <td>
                  *null*
                </td>
              </tr>
              </tbody>
            </table>
          </emu-table>
        </emu-note>

        <p>The following definitions specify the required concrete methods and other abstract operations for Source Text Module Records</p>

        <!-- es6num="15.2.1.16.1" -->
        <emu-clause id="sec-parsemodule" aoid="ParseModule">
          <h1>ParseModule ( _sourceText_, _realm_, _hostDefined_ )</h1>
          <p>The abstract operation ParseModule with arguments _sourceText_, _realm_, and _hostDefined_ creates a Source Text Module Record based upon the result of parsing _sourceText_ as a |Module|. ParseModule performs the following steps:</p>
          <emu-alg>
            1. Assert: _sourceText_ is an ECMAScript source text (see clause <emu-xref href="#sec-ecmascript-language-source-code"></emu-xref>).
            1. Parse _sourceText_ using |Module| as the goal symbol and analyse the parse result for any Early Error conditions. If the parse was successful and no early errors were found, let _body_ be the resulting parse tree. Otherwise, let _body_ be a List of one or more *SyntaxError* or *ReferenceError* objects representing the parsing errors and/or early errors. Parsing and early error detection may be interweaved in an implementation-dependent manner. If more than one parsing error or early error is present, the number and ordering of error objects in the list is implementation-dependent, but at least one must be present.
            1. If _body_ is a List of errors, return _body_.
            1. Let _requestedModules_ be the ModuleRequests of _body_.
            1. Let _importEntries_ be ImportEntries of _body_.
            1. Let _importedBoundNames_ be ImportedLocalNames(_importEntries_).
            1. Let _indirectExportEntries_ be a new empty List.
            1. Let _localExportEntries_ be a new empty List.
            1. Let _starExportEntries_ be a new empty List.
            1. Let _exportEntries_ be ExportEntries of _body_.
            1. For each ExportEntry Record _ee_ in _exportEntries_, do
              1. If _ee_.[[ModuleRequest]] is *null*, then
                1. If _ee_.[[LocalName]] is not an element of _importedBoundNames_, then
                  1. Append _ee_ to _localExportEntries_.
                1. Else,
                  1. Let _ie_ be the element of _importEntries_ whose [[LocalName]] is the same as _ee_.[[LocalName]].
                  1. If _ie_.[[ImportName]] is `"*"`, then
                    1. Assert: This is a re-export of an imported module namespace object.
                    1. Append _ee_ to _localExportEntries_.
                  1. Else this is a re-export of a single name,
                    1. Append the ExportEntry Record {[[ModuleRequest]]: _ie_.[[ModuleRequest]], [[ImportName]]: _ie_.[[ImportName]], [[LocalName]]: *null*, [[ExportName]]: _ee_.[[ExportName]] } to _indirectExportEntries_.
              1. Else if _ee_.[[ImportName]] is `"*"` and <ins>_ee_.[[ExportName]] is *null*,</ins> then
                1. Append _ee_ to _starExportEntries_.
              1. Else,
                1. Append _ee_ to _indirectExportEntries_.
            1. Return Source Text Module Record {[[Realm]]: _realm_, [[Environment]]: *undefined*, [[Namespace]]: *undefined*, [[Status]]: `"uninstantiated"`, [[EvaluationError]]: *undefined*, [[HostDefined]]: _hostDefined_, [[ECMAScriptCode]]: _body_, [[RequestedModules]]: _requestedModules_, [[ImportEntries]]: _importEntries_, [[LocalExportEntries]]: _localExportEntries_, [[IndirectExportEntries]]: _indirectExportEntries_, [[StarExportEntries]]: _starExportEntries_, [[DFSIndex]]: *undefined*, [[DFSAncestorIndex]]: *undefined*}.
          </emu-alg>
          <emu-note>
            <p>An implementation may parse module source text and analyse it for Early Error conditions prior to the evaluation of ParseModule for that module source text. However, the reporting of any errors must be deferred until the point where this specification actually performs ParseModule upon that source text.</p>
          </emu-note>
        </emu-clause>

        <emu-clause id="sec-resolveexport">
          <h1>ResolveExport( _exportName_, _resolveSet_ ) Concrete Method</h1>
          <p>The ResolveExport concrete method of a Source Text Module Record implements the corresponding Module Record abstract method.</p>

          <p>ResolveExport attempts to resolve an imported binding to the actual defining module and local binding name. The defining module may be the module represented by the Module Record this method was invoked on or some other module that is imported by that module. The parameter _resolveSet_ is used to detect unresolved circular import/export paths. If a pair consisting of specific Module Record and _exportName_ is reached that is already in _resolveSet_, an import circularity has been encountered. Before recursively calling ResolveExport, a pair consisting of _module_ and _exportName_ is added to _resolveSet_.</p>

          <p>If a defining module is found, a ResolvedBinding Record {[[Module]], [[BindingName]]<ins>, [[isNamespace]]</ins>} is returned. This record identifies the resolved binding of the originally requested export. If no definition was found or the request is found to be circular, *null* is returned. If the request is found to be ambiguous, the string `"ambiguous"` is returned.</p>

          <p>This abstract method performs the following steps:</p>

          <emu-alg>
            1. Let _module_ be this Source Text Module Record.
            1. For each Record {[[Module]], [[ExportName]]} _r_ in _resolveSet_, do
              1. If _module_ and _r_.[[Module]] are the same Module Record and SameValue(_exportName_, _r_.[[ExportName]]) is *true*, then
                1. Assert: This is a circular import request.
                1. Return *null*.
            1. Append the Record {[[Module]]: _module_, [[ExportName]]: _exportName_} to _resolveSet_.
            1. For each ExportEntry Record _e_ in _module_.[[LocalExportEntries]], do
              1. If SameValue(_exportName_, _e_.[[ExportName]]) is *true*, then
                1. Assert: _module_ provides the direct binding for this export.
                1. <del>Return ResolvedBinding Record {[[Module]]: _module_, [[BindingName]]: _e_.[[LocalName]]}.</del>
                1. <ins>Return ResolvedBinding Record {[[Module]]: _module_, [[BindingName]]: _e_.[[LocalName]], [[isNamespace]]: *false*}.</ins>
            1. For each ExportEntry Record _e_ in _module_.[[IndirectExportEntries]], do
              1. If SameValue(_exportName_, _e_.[[ExportName]]) is *true*, then
                1. <ins>If _e_.[[ImportName]] is `"*"`, then</ins>
                  1. <ins>NOTE: _module_ does not provide the direct binding for this export.</ins>
                  1. <ins>Return ResolvedBinding Record {[[Module]]: _e_.[[ModuleRequest]], [[BindingName]]: _e_.[[ExportName]], [[isNamespace]]: *true*}.</ins>
                1. <ins>Else,</ins>
                  1. <ins>Assert: _module_ imports a specific binding for this export.</ins>
                  1. <ins>Let _importedModule_ be ? HostResolveImportedModule(_module_, _e_.[[ModuleRequest]]).</ins>
                  1. <ins>Return _importedModule_.ResolveExport(_e_.[[ImportName]], _resolveSet_)</ins>
                1. <del>Assert: _module_ imports a specific binding for this export.</del>
                1. <del>Let _importedModule_ be ? HostResolveImportedModule(_module_, _e_.[[ModuleRequest]]).</del>
                1. <del>Return _importedModule_.ResolveExport(_e_.[[ImportName]], _resolveSet_).</del>
            1. If SameValue(_exportName_, `"default"`) is *true*, then
              1. Assert: A `default` export was not explicitly defined by this module.
              1. Return *null*.
              1. NOTE: A `default` export cannot be provided by an `export *`.
            1. Let _starResolution_ be *null*.
            1. For each ExportEntry Record _e_ in _module_.[[StarExportEntries]], do
              1. Let _importedModule_ be ? HostResolveImportedModule(_module_, _e_.[[ModuleRequest]]).
              1. Let _resolution_ be ? _importedModule_.ResolveExport(_exportName_, _resolveSet_).
              1. If _resolution_ is `"ambiguous"`, return `"ambiguous"`.
              1. If _resolution_ is not *null*, then
                1. Assert: _resolution_ is a ResolvedBinding Record.
                1. If _starResolution_ is *null*, set _starResolution_ to _resolution_.
                1. Else,
                  1. Assert: There is more than one `*` import that includes the requested name.
                  1. If _resolution_.[[Module]] and _starResolution_.[[Module]] are not the same Module Record or SameValue(_resolution_.[[BindingName]], _starResolution_.[[BindingName]]) is *false*, return `"ambiguous"`.
            1. Return _starResolution_.
          </emu-alg>
        </emu-clause>

        <!-- es6num="15.2.1.16.4" -->
        <emu-clause id="sec-moduledeclarationinstantiation">
          <h1>Instantiate( ) Concrete Method</h1>

          <p>The Instantiate concrete method of a Source Text Module Record implements the corresponding Module Record abstract method.</p>
          <p>On success, Instantiate transitions this module's [[Status]] from `"uninstantiated"` to `"instantiated"`. On failure, an exception is thrown and this module's [[Status]] remains `"uninstantiated"`.</p>

          <p>This abstract method performs the following steps (most of the work is done by the auxiliary function InnerModuleInstantiation):</p>

          <emu-alg>
            1. Let _module_ be this Source Text Module Record.
            1. Assert: _module_.[[Status]] is not `"instantiating"` or `"evaluating"`.
            1. Let _stack_ be a new empty List.
            1. Let _result_ be InnerModuleInstantiation(_module_, _stack_, 0).
            1. If _result_ is an abrupt completion, then
              1. For each module _m_ in _stack_, do
                1. Assert: _m_.[[Status]] is `"instantiating"`.
                1. Set _m_.[[Status]] to `"uninstantiated"`.
                1. Set _m_.[[Environment]] to *undefined*.
                1. Set _m_.[[DFSIndex]] to *undefined*.
                1. Set _m_.[[DFSAncestorIndex]] to *undefined*.
              1. Assert: _module_.[[Status]] is `"uninstantiated"`.
              1. Return _result_.
            1. Assert: _module_.[[Status]] is `"instantiated"` or `"evaluated"`.
            1. Assert: _stack_ is empty.
            1. Return *undefined*.
          </emu-alg>


          <emu-clause id="sec-moduledeclarationenvironmentsetup" aoid="ModuleDeclarationEnvironmentSetup">
            <h1>ModuleDeclarationEnvironmentSetup( _module_ )</h1>

            <p>The ModuleDeclarationEnvironmentSetup abstract operation is used by InnerModuleInstantiation to initialize the Lexical Environment of the module, including resolving all imported bindings.</p>

            <p>This abstract operation performs the following steps:</p>

            <emu-alg>
              1. For each ExportEntry Record _e_ in _module_.[[IndirectExportEntries]], do
                1. Let _resolution_ be ? _module_.ResolveExport(_e_.[[ExportName]], &laquo; &raquo;).
                1. If _resolution_ is *null* or `"ambiguous"`, throw a *SyntaxError* exception.
                1. Assert: _resolution_ is a ResolvedBinding Record.
              1. Assert: All named exports from _module_ are resolvable.
              1. Let _realm_ be _module_.[[Realm]].
              1. Assert: _realm_ is not *undefined*.
              1. Let _env_ be NewModuleEnvironment(_realm_.[[GlobalEnv]]).
              1. Set _module_.[[Environment]] to _env_.
              1. Let _envRec_ be _env_'s EnvironmentRecord.
              1. For each ImportEntry Record _in_ in _module_.[[ImportEntries]], do
                1. Let _importedModule_ be ! HostResolveImportedModule(_module_, _in_.[[ModuleRequest]]).
                1. NOTE: The above call cannot fail because imported module requests are a subset of _module_.[[RequestedModules]], and these have been resolved earlier in this algorithm.
                1. If _in_.[[ImportName]] is `"*"`, then
                  1. Let _namespace_ be ? GetModuleNamespace(_importedModule_).
                  1. Perform ! _envRec_.CreateImmutableBinding(_in_.[[LocalName]], *true*).
                  1. Call _envRec_.InitializeBinding(_in_.[[LocalName]], _namespace_).
                1. Else,
                  1. Let _resolution_ be ? _importedModule_.ResolveExport(_in_.[[ImportName]], &laquo; &raquo;).
                  1. If _resolution_ is *null* or `"ambiguous"`, throw a *SyntaxError* exception.
                  1. <ins>If _resolution_.[[isNamespace]], then</ins>
                    1. <ins>Let _namespace_ be ? GetModuleNamespace(_resolution_.[[Module]]).</ins>
                    1. <ins>Perform ! _envRec_.CreateImmutableBinding(_in_.[[LocalName]], *true*).</ins>
                    1. <ins>Call _envRec_.InitializeBinding(_in_.[[LocalName]], _namespace_).</ins>
                  1. <ins>Else,</ins>
                    1. <ins>Call _envRec_.CreateImportBinding(_in_.[[LocalName]], _resolution_.[[Module]], _resolution_.[[BindingName]]).</ins>
                  1. <del>Call _envRec_.CreateImportBinding(_in_.[[LocalName]], _resolution_.[[Module]], _resolution_.[[BindingName]]).<del>
              1. Let _code_ be _module_.[[ECMAScriptCode]].
              1. Let _varDeclarations_ be the VarScopedDeclarations of _code_.
              1. Let _declaredVarNames_ be a new empty List.
              1. For each element _d_ in _varDeclarations_, do
                1. For each element _dn_ of the BoundNames of _d_, do
                  1. If _dn_ is not an element of _declaredVarNames_, then
                    1. Perform ! _envRec_.CreateMutableBinding(_dn_, *false*).
                    1. Call _envRec_.InitializeBinding(_dn_, *undefined*).
                    1. Append _dn_ to _declaredVarNames_.
              1. Let _lexDeclarations_ be the LexicallyScopedDeclarations of _code_.
              1. For each element _d_ in _lexDeclarations_, do
                1. For each element _dn_ of the BoundNames of _d_, do
                  1. If IsConstantDeclaration of _d_ is *true*, then
                    1. Perform ! _envRec_.CreateImmutableBinding(_dn_, *true*).
                  1. Else,
                    1. Perform ! _envRec_.CreateMutableBinding(_dn_, *false*).
                  1. If _d_ is a |FunctionDeclaration|, a |GeneratorDeclaration|, an |AsyncFunctionDeclaration|, or an |AsyncGeneratorDeclaration|, then
                    1. Let _fo_ be the result of performing InstantiateFunctionObject for _d_ with argument _env_.
                    1. Call _envRec_.InitializeBinding(_dn_, _fo_).
            </emu-alg>
          </emu-clause>
        </emu-clause>

      </emu-clause>
    </emu-clause>

    <!-- es6num="15.2.3" -->
    <emu-clause id="sec-exports">
      <h1>Exports</h1>
      <h2>Syntax</h2>

      <emu-grammar>
        ExportDeclaration :
          `export` VariableStatement
          `export` Declaration
          `export` `default` HoistableDeclaration[Default]
          `export` `default` ClassDeclaration[Default]
          `export` `default` [lookahead &lt;! {`function`, `class`}] AssignmentExpression[In] `;`
      </emu-grammar>
      <del class="block">
      <emu-grammar>
        ExportDeclaration :
          `export` `*` FromClause `;`
          `export` ExportClause FromClause `;`
          `export` ExportClause `;`
      </emu-grammar>
      </del>
      <ins class="block">
      <emu-grammar>
        ExportDeclaration :
          `export` ExportFromClause FromClause `;`
          `export` NamedExports `;`

        ExportFromClause :
          `*`
          NamedExports
          NameSpaceExport

        NameSpaceExport :
          `*` `as` IdentifierName
      </emu-grammar>
      </ins>

      <del class="block">
      <emu-grammar>
        ExportClause :
          `{` `}`
          `{` ExportsList `}`
          `{` ExportsList `,` `}`
      </emu-grammar>
      </del>
      <ins class="block">
      <emu-grammar>
        NamedExports :
          `{` `}`
          `{` ExportsList `}`
          `{` ExportsList `,` `}`
      </emu-grammar>
      </ins>
      <emu-note>Renaming |ExportClause| to |NamedExports| reflects the similarly
        named |NamedImports|, and should be reflected throughout the spec.</emu-note>

      <emu-grammar>
        ExportsList :
          ExportSpecifier
          ExportsList `,` ExportSpecifier

        ExportSpecifier :
          IdentifierName
          IdentifierName `as` IdentifierName
      </emu-grammar>

      <!-- es6num="15.2.3.2" -->
      <emu-clause id="sec-exports-static-semantics-boundnames">
        <h1>Static Semantics: BoundNames</h1>
        <del class="block">
        <emu-grammar>
          ExportDeclaration :
            `export` `*` FromClause `;`
            `export` ExportClause FromClause `;`
            `export` ExportClause `;`
        </emu-grammar>
        </del>
        <ins class="block">
        <emu-grammar>
          ExportDeclaration :
            `export` ExportFromClause FromClause `;`
            `export` NamedExports `;`
        </emu-grammar>
        </ins>
        <emu-alg>
          1. Return a new empty List.
        </emu-alg>
      </emu-clause>

      <!-- es6num="15.2.3.3" -->
      <emu-clause id="sec-exports-static-semantics-exportedbindings">
        <h1>Static Semantics: ExportedBindings</h1>
        <del class="block">
        <emu-grammar>
          ExportDeclaration :
            `export` ExportClause FromClause `;`
            `export` `*` FromClause `;`
        </emu-grammar>
        </del>
        <ins class="block">
        <emu-grammar>
          ExportDeclaration :
            `export` ExportFromClause FromClause `;`
        </emu-grammar>
        </ins>
        <emu-alg>
          1. Return a new empty List.
        </emu-alg>
      </emu-clause>

      <!-- es6num="15.2.3.4" -->
      <emu-clause id="sec-exports-static-semantics-exportednames">
        <h1>Static Semantics: ExportedNames</h1>
        <del class="block">
        <emu-grammar>ExportDeclaration : `export` `*` FromClause `;`</emu-grammar>
        <emu-alg>
          1. Return a new empty List.
        </emu-alg>
        <emu-grammar>
          ExportDeclaration :
            `export` ExportClause FromClause `;`
            `export` ExportClause `;`
        </emu-grammar>
        <emu-alg>
          1. Return the ExportedNames of |ExportClause|.
        </emu-alg>
        </del>

        <ins class="block">
        <emu-grammar>ExportDeclaration : `export` ExportFromClause FromClause `;`</emu-grammar>
        <emu-alg>
          1. Return the ExportedNames of ExportFromClause.
        </emu-alg>
        <emu-grammar>ExportFromClause : `*`</emu-grammar>
        <emu-alg>
          1. Return a new empty List.
        </emu-alg>
        <emu-grammar>ExportFromClause : NamedExports</emu-grammar>
        <emu-alg>
          1. Return the ExportedNames of |NamedExports|.
        </emu-alg>
        <emu-grammar>NameSpaceExport : `*` `as` IdentifierName </emu-grammar>
        <emu-alg>
          1. Return a List containing the StringValue of |IdentifierName|.
        </emu-alg>
        </ins>
      </emu-clause>

      <!-- es6num="15.2.3.5" -->
      <emu-clause id="sec-exports-static-semantics-exportentries">
        <h1>Static Semantics: ExportEntries</h1>
        <del class="block">
        <emu-grammar>ExportDeclaration : `export` `*` FromClause `;`</emu-grammar>
        <emu-alg>
          1. Let _module_ be the sole element of ModuleRequests of |FromClause|.
          1. Let _entry_ be the Record {[[ModuleRequest]]: _module_, [[ImportName]]: `"*"`, [[LocalName]]: *null*, [[ExportName]]: *null* }.
          1. Return a new List containing _entry_.
        </emu-alg>
        <emu-grammar>ExportDeclaration : `export` ExportClause FromClause `;`</emu-grammar>
        <emu-alg>
          1. Let _module_ be the sole element of ModuleRequests of |FromClause|.
          1. Return ExportEntriesForModule of |ExportClause| with argument _module_.
        </emu-alg>
        </del>
        <ins class="block">
        <emu-grammar>ExportDeclaration : `export` ExportFromClause FromClause `;`</emu-grammar>
        <emu-alg>
          1. Let _module_ be the sole element of ModuleRequests of |FromClause|.
          1. Return ExportEntriesForModule of |ExportFromClause| with argument _module_.
        </emu-alg>
        </ins>
      </emu-clause>

      <!-- es6num="15.2.3.6" -->
      <emu-clause id="sec-static-semantics-exportentriesformodule">
        <h1>Static Semantics: ExportEntriesForModule</h1>
        <p>With parameter _module_.</p>
        <ins class="block">
        <emu-grammar>ExportFromClause : `*`</emu-grammar>
        <emu-alg>
          1. Return a new List containing the Record {[[ModuleRequest]]: _module_, [[ImportName]]: "*", [[LocalName]]: null, [[ExportName]]: null }.
        </emu-alg>
        <emu-grammar>NameSpaceExport : `*` as IdentifierName</emu-grammar>
        <emu-alg>
          1. Let _exportName_ be the StringValue of |IdentifierName|.
          1. Return a new List containing the Record {[[ModuleRequest]]: _module_, [[ImportName]]: "*", [[LocalName]]: null, [[ExportName]]: _exportName_ }.
        </emu-alg>
        </ins>
      </emu-clause>

      <!-- es6num="15.2.3.7" -->
      <emu-clause id="sec-exports-static-semantics-isconstantdeclaration">
        <h1>Static Semantics: IsConstantDeclaration</h1>
        <del class="block">
        <emu-grammar>
          ExportDeclaration :
            `export` `*` FromClause `;`
            `export` ExportClause FromClause `;`
            `export` ExportClause `;`
            `export` `default` AssignmentExpression `;`
        </emu-grammar>
        </del>
        <ins class="block">
        <emu-grammar>
          ExportDeclaration :
            `export` ExportFromClause FromClause `;`
            `export` NamedExports `;`
            `export` `default` AssignmentExpression `;`
        </emu-grammar>
        </ins>
        <emu-alg>
          1. Return *false*.
        </emu-alg>
      </emu-clause>

      <!-- es6num="15.2.3.8" -->
      <emu-clause id="sec-exports-static-semantics-lexicallyscopeddeclarations">
        <h1>Static Semantics: LexicallyScopedDeclarations</h1>
        <del class="block">
        <emu-grammar>
          ExportDeclaration :
            `export` `*` FromClause `;`
            `export` ExportClause FromClause `;`
            `export` ExportClause `;`
            `export` VariableStatement
        </emu-grammar>
        </del>
        <ins class="block">
        <emu-grammar>
          ExportDeclaration :
            `export` ExportFromClause FromClause `;`
            `export` NamedExports `;`
            `export` VariableStatement
        </emu-grammar>
        </ins>
        <emu-alg>
          1. Return a new empty List.
        </emu-alg>
      </emu-clause>

      <!-- es6num="15.2.3.9" -->
      <emu-clause id="sec-exports-static-semantics-modulerequests">
        <h1>Static Semantics: ModuleRequests</h1>
        <del class="block">
        <emu-grammar>
          ExportDeclaration : `export` `*` FromClause `;`

          ExportDeclaration : `export` ExportClause FromClause `;`
        </emu-grammar>
        </del>
        <ins class="block">
        <emu-grammar>
          ExportDeclaration : `export` ExportFromClause FromClause `;`
        </emu-grammar>
        </ins>
        <emu-alg>
          1. Return the ModuleRequests of |FromClause|.
        </emu-alg>
      </emu-clause>

      <!-- es6num="15.2.3.11" -->
      <emu-clause id="sec-exports-runtime-semantics-evaluation">
        <h1>Runtime Semantics: Evaluation</h1>
        <del class="block">
        <emu-grammar>
          ExportDeclaration :
            `export` `*` FromClause `;`
            `export` ExportClause FromClause `;`
            `export` ExportClause `;`
        </emu-grammar>
        </del>
        <ins class="block">
        <emu-grammar>
          ExportDeclaration :
            `export` ExportFromClause FromClause `;`
            `export` NamedExports `;`
        </emu-grammar>
        </ins>
        <emu-alg>
          1. Return NormalCompletion(~empty~).
        </emu-alg>
      </emu-clause>
    </emu-clause>
  </emu-clause>
</emu-clause>
